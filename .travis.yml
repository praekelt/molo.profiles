sudo: false
language: python
python:
  - "2.7"
cache:
  directories:
    - $HOME/.pip-cache/
install:
  - pip install --upgrade pip --cache-dir $HOME/.pip-cache/
  - pip install coveralls coverage --cache-dir $HOME/.pip-cache/
  - pip install flake8 --cache-dir $HOME/.pip-cache/
  - pip install -r requirements-dev.txt --cache-dir $HOME/.pip-cache/
  - pip install -e . --cache-dir $HOME/.pip-cache/
  # install latest from git feature branch because that hasn't landed yet.
  - pip install -e git+git://github.com/praekelt/molo@feature/issue-33-profiles#egg=molo
script:
  - flake8 molo
  - molo scaffold testapp --include molo.profiles ^profiles/
  - flake8 testapp
  - pip install -e testapp
  - py.test --ds=testapp.settings ./molo/
after_success:
  - coveralls
deploy:
  provider: pypi
  user: Praekelt
  password:
    secure: "ZKMi1miMe9HSKPpb3m4twEJ3niCqCGPPSahEfcJVDhP+Qd22JUMa317fLkj0qCk4kv6C3Q8lUMU7vE6aPlhvGqP1q3z4aS+KOgMiCb+hR8S7/vpT3K9xTcdpHorY6g91aHsMxSRCXAMHroXIG1ut4iJLt+C7C8cC9TdazIq9zyLhKkXLdRZ9qcHKDEabCRQhvbxwp9OHFi8EbYvhxhIsi+C1bsSRDpgOKuKnPDgZqn9+EheC1BaRTbuOpBeRLoQpl1OsDaq8Jir1kBAnVmzGvsfm09Nrj1uyuDTaP72uDE5KkhLIvcPKwqpMs8UFpx+Q2Rd3JkWoed5toxNK9VI/19MbempksoTzf3Bsy/W5y/rcOP0inR5XWDakUUb2Z5DbKiilmfDM3xrjFWxb+UFQmR7SXpIhBAy8Eyotn2R3HlGWOAQow7p0hfYF9/RHv6VmrYqdF7vIx8oZgTk6JM6hCaprMHy9SfFo8NG/dy6oCRBDAikTZ+I6Ma36R08CsAGfmsStYBmU1EkaJC6bLHBMFV9W6xzpMkSpkWque72h7FPehNNOBNtm3tujhIw5jncM7l6aOviDwnrrOiiytqKH68nqzeo0vXxFt3bLD/MwBJl9ba9nxcn29KniqrE3jsrh6Hd3c8Ig6b4xO9vNiOQiqK+PVKSxqkXj2lHt9J+Vd0Q="
  on:
    tags: true
    all_branches: true
